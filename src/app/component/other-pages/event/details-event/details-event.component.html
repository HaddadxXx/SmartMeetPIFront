<!-- Bouton Filtrer -->
<div class="event-header">
  <div class="event-title">
    <h3 class="mb-4"><strong>Événements disponibles</strong></h3>
  </div>
  <div class="filter-button">
    <button class="btn btn-outline-secondary" (click)="showFilters = !showFilters">
      <i class="fa fa-filter me-1"></i> Filtrer
    </button>
  </div>
</div>
  
  <!-- Section de filtre sans fond ni bordure -->
  <div *ngIf="showFilters" class="mb-4">
  
    <!-- Type -->
    <div class="mb-3">
      <label class="fw-bold me-3">Type :</label>
      <label class="me-2">
        <input type="radio" name="typeEvent" value="" [(ngModel)]="filters.typeEvent"> Tous
      </label>
      <label class="me-2">
        <input type="radio" name="typeEvent" value="en ligne" [(ngModel)]="filters.typeEvent"> En ligne
      </label>
      <label>
        <input type="radio" name="typeEvent" value="présentiel" [(ngModel)]="filters.typeEvent"> Présentiel
      </label>
    </div>
  
    <!-- Thème -->
    <div class="mb-3">
      <label class="fw-bold d-block mb-2">Thèmes :</label>
      <ng-container *ngFor="let theme of availableThemes">
        <label class="me-3">
          <input type="checkbox" [value]="theme" > {{ theme }}
        </label>
      </ng-container>
    </div>
  
    <!-- Mois -->
    <div class="mb-3">
      <label class="fw-bold me-2">Mois :</label>
      <select class="form-select w-auto d-inline-block" [(ngModel)]="filters.month">
        <option value="">Tous les mois</option>
        <option *ngFor="let m of months" [value]="m">{{ m }}</option>
      </select>
    </div>
  
    <!-- Boutons -->
    <div class="d-flex gap-2">
      <button class="btn btn-success" (click)="applyFilter()">Filtrer</button>
      <button class="btn btn-outline-secondary">Réinitialiser</button>
    </div>
  </div>

  

<!-- event-details.component.html -->

<div class="row d-flex flex-wrap gap-3">
  <div class="detailes-event section-b-space">
    <div class="row d-flex flex-wrap gap-3">
      <div class="detailes-event-card" *ngFor="let event of events">
        <div class="border p-3 rounded shadow-sm">
          <p><strong>🎯 Event Name:</strong> {{ event.nomEvent }}</p>
          <p><strong>📚 Theme:</strong> {{ event.theme }}</p>
          <p><strong>📝 Description:</strong><br> {{ event.description }}</p>
          <p><strong>📅 Start Date:</strong> {{ event.dateDebut | date:'longDate' }}</p>
          <p><strong>📅 End Date:</strong> {{ event.dateFin | date:'longDate' }}</p>
          <p><strong>👥 Capacity:</strong> {{ event.capacite }}</p>
          <p><strong>🧭 Type:</strong> {{ event.typeEvent }}</p>
          <p><strong>🕒 Schedule:</strong> {{ event.horaire }}</p>
          <p><strong>📍 Location:</strong>
            {{ event.lieu?.toLowerCase() === 'en ligne' || event.typeEvent?.toLowerCase() === 'en ligne' ? 'Online' : event.lieu }}
          </p>

          <div *ngIf="event.participations?.length">
            <p><strong>✅ Participants:</strong></p>
            <ul>
              <li *ngFor="let part of event.participations">{{ part?.user?.name || 'Unknown participant' }}</li>
            </ul>
          </div>

          <div *ngIf="event.sessions?.length">
            <p><strong>📅 Sessions:</strong></p>
            <ul>
              <li *ngFor="let session of event.sessions">{{ session?.title || 'Unnamed Session' }}</li>
            </ul>
          </div>

          <img *ngIf="event.photo" [src]="'http://localhost:8889/uploads/' + event.photo" alt="Event image" class="img-fluid my-2" />

          <button class="btn btn-outline-primary mt-2" (click)="verifierEtat(event.idEvent)">
            Check Status
          </button>

          <p *ngIf="message">{{ message }}</p>

          <div class="mt-4 text-center">
            <button class="btn btn-success" (click)="openParticipationModal(participationModal, event.nomEvent)">
              <i class="fa fa-check"></i> Participate
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- Pagination -->
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" href="javascript:void(0)" (click)="currentPage > 0 && goToPage(currentPage - 1)">Précédent</a>
        </li>
  
        <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="i === currentPage">
          <a class="page-link" href="javascript:void(0)" (click)="goToPage(i)">{{ i + 1 }}</a>
        </li>
  
        <li class="page-item" [class.disabled]="currentPage >= totalPages - 1">
          <a class="page-link" href="javascript:void(0)" (click)="currentPage < totalPages - 1 && goToPage(currentPage + 1)">Next</a>
        </li>
      </ul>
    </nav>
  </div>
  

 <!-- ✅ MODALE PARTICIPATION -->


<!-- ✅ Liste des événements
<div *ngFor="let event of events" class="mb-2 d-flex justify-content-between align-items-center">
  <div>
    <strong>{{ event.nomEvent }}</strong>
  </div>
  <button class="btn btn-success btn-sm"
          (click)="openParticipationModal(participationModal, event.nomEvent)">
    <i class="fa fa-check"></i> Participer
  </button>
</div> -->

<!-- ✅ MODALE PARTICIPATION -->
<ng-template #participationModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Participation à : {{ selectedEvent?.nomEvent }}</h5>
    <button type="button" class="btn-close" aria-label="Fermer" (click)="modal.dismiss('fermer')"></button>
  </div>

  <div class="modal-body">
    <form (ngSubmit)="onSubmitParticipation()" #participationForm="ngForm" enctype="multipart/form-data">
      <div class="row g-3">
        
        <div class="col-md-6">
          <label>FirstName</label>
          <input type="text" class="form-control" name="nom" ngModel />
        </div>
        <div class="col-md-6">
          <label>LastName</label>
          <input type="text" class="form-control" name="prenom" ngModel />
        </div>
        <div class="col-md-6">
          <label>Email</label>
          <input type="email" class="form-control" name="email" [(ngModel)]="participationData.email" required />
        </div>
        <div class="col-md-6">
          <label>Folders</label>
          <input type="file" class="form-control" (change)="onFileSelected($event)" />
        </div>
        <div class="col-12">
          <label>Associated Event</label>
          <li *ngFor="let session of selectedEvent?.sessions">{{ session.titre }}</li>
          <!-- <li *ngFor="let session of selectedEvent?.sessions">{{ session.titre }}</li> -->
          <ng-template #noSessions><em>Aucune session</em></ng-template>
        </div>
      </div>
      <!-- Message d'analyse IA -->
<div class="alert mt-3"
[ngClass]="{
  'alert-success': aiValidated,
  'alert-danger': !aiValidated
}" *ngIf="analysisResult">
<strong>Analyse IA :</strong><br>
Thème cible : {{ analysisResult.theme }}<br>
Similarité : {{ analysisResult.similarity }} %<br>
Résultat : {{ analysisResult.status }}
</div>
      <div class="mt-3 text-end">
        <button type="submit" class="btn btn-primary"
        [disabled]="!participationForm.valid || !aiValidated">
  Envoyer
</button>      </div>
    </form>
  </div>
</ng-template>
